name: Update Last Work Card (Local SVG)

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

permissions:
  contents: write

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Detect latest active repository
        run: |
          PROFILE_REPO="Damavarun"

          FULL_REPO=$(curl -s https://api.github.com/users/Damavarun/repos?sort=updated \
            | jq -r --arg profile "$PROFILE_REPO" '
              .[]
              | select(.name != $profile)
              | .full_name
            ' | head -n 1)

          echo "REPO=$FULL_REPO" >> $GITHUB_ENV

      - name: Generate SVG card
        run: |
          REPO_NAME=$(echo "$REPO" | cut -d'/' -f2)
          OWNER=$(echo "$REPO" | cut -d'/' -f1)

          cat > last-work.svg <<EOF
          <svg width="500" height="120" xmlns="http://www.w3.org/2000/svg">
            <rect width="100%" height="100%" rx="14" fill="#0d1117"/>
            <text x="20" y="40" fill="#f0f6fc" font-size="18" font-family="Arial">
              ðŸš€ Last Work Done
            </text>
            <text x="20" y="70" fill="#58a6ff" font-size="16" font-family="Arial">
              ${OWNER}/${REPO_NAME}
            </text>
            <text x="20" y="95" fill="#8b949e" font-size="14" font-family="Arial">
              Recently updated repository
            </text>
          </svg>
          EOF

      - name: Commit SVG
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add last-work.svg
          git commit -m "chore: update last work svg" || echo "No changes"
          git push
